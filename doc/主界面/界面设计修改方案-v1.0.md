
收到你的反馈，目前的界面已经初具雏形，但确实存在布局重复（出现了两个发送图标）和系统标题栏不协调的问题。

针对你提出的三个改进点，我整理了详细的设计描述和优化后的 QML 代码。

---

### 一、 界面改进设计描述 (Markdown)

#### 1. 沉浸式标题栏 (Custom Title Bar)
- **实现方式**：隐藏系统默认边框（FramelessWindowHint），在 QML 中自定义一个位于顶部的拖拽区域。
- **视觉**：背景色设为与侧边栏一致的 `#171717`，移除原本 Windows 默认的白边，实现完全的暗黑沉浸感。
- **交互**：左上角放置软件名称，右上角自定义 最小化/关闭 按钮。

#### 2. 可伸缩侧边栏 (Toggleable Sidebar)
- **交互**：在侧边栏顶部或左上角添加一个“汉堡菜单”图标按钮。
- **动画**：点击后，`sidebarWidth` 在 `260` (展开) 和 `64` (折叠) 之间切换。
- **内容适配**：折叠状态下隐藏文字标签，仅保留图标（如“+”号和“⚙️”），保持界面整洁。

#### 3. 仿 Ollama 输入框 (Refined Input Field)
- **结构优化**：删除多余的 `ColumnLayout` 和重复的按钮。采用单一 `RowLayout` 容器。
- **视觉**：
    - 容器为圆角矩形（Radius 约 20-25）。
    - 输入区域（TextArea）位于左侧，支持自动高度。
    - 发送按钮位于右端，采用圆形设计。
- **占位符**：提示词颜色减淡，聚焦时边框微亮。

---

### 二、 参考代码实现

你可以直接替换原有的 `main.qml` 内容。

```qml
import QtQuick
import QtQuick.Controls
import QtQuick.Layouts
import QtQuick.Window

ApplicationWindow {
    id: window
    width: 1100
    height: 750
    visible: true
    title: "digital-garden-chat"
    color: "#0f0f0f"

    // 1. 移除系统边框，实现沉浸式标题
    flags: Qt.Window | Qt.FramelessWindowHint

    property real sidebarWidth: 260
    property bool sidebarExpanded: true

    // 侧边栏宽度动画
    Behavior on sidebarWidth {
        NumberAnimation { duration: 250; easing.type: Easing.InOutQuad }
    }

    // ------------------ 自定义标题栏 (可拖拽窗口) ------------------
    Rectangle {
        id: titleBar
        width: parent.width
        height: 40
        color: "#171717"
        z: 10

        DragHandler {
            onActiveChanged: if (active) window.startSystemMove()
        }

        RowLayout {
            anchors.fill: parent
            anchors.leftMargin: 15
            anchors.rightMargin: 10
            
            Text {
                text: "Digital Garden Chat"
                color: "#666"
                font.pixelSize: 12
                Layout.alignment: Qt.AlignVCenter
            }

            Item { Layout.fillWidth: true } // 占位

            // 窗口控制按钮
            Row {
                spacing: 5
                Button {
                    width: 30; height: 30
                    contentItem: Text { text: "—"; color: "#888"; horizontalAlignment: Text.AlignHCenter }
                    background: null
                    onClicked: window.showMinimized()
                }
                Button {
                    width: 30; height: 30
                    contentItem: Text { text: "✕"; color: "#888"; horizontalAlignment: Text.AlignHCenter }
                    background: null
                    onClicked: window.close()
                }
            }
        }
    }

    // ------------------ 侧边栏 ------------------
    Rectangle {
        id: sidebar
        width: sidebarWidth
        anchors.left: parent.left
        anchors.top: titleBar.bottom
        anchors.bottom: parent.bottom
        color: "#171717"

        ColumnLayout {
            anchors.fill: parent
            anchors.margins: 12
            spacing: 10

            // 侧边栏开关按钮
            Button {
                Layout.preferredWidth: 40
                Layout.preferredHeight: 40
                onClicked: {
                    sidebarExpanded = !sidebarExpanded
                    sidebarWidth = sidebarExpanded ? 260 : 64
                }
                background: Rectangle {
                    color: parent.hovered ? "#2a2a2a" : "transparent"
                    radius: 8
                }
                contentItem: Text {
                    text: "☰"
                    color: "white"
                    font.pixelSize: 18
                    horizontalAlignment: Text.AlignHCenter
                    verticalAlignment: Text.AlignVCenter
                }
            }

            // 新建对话
            Button {
                Layout.fillWidth: true
                Layout.preferredHeight: 45
                background: Rectangle {
                    color: parent.hovered ? "#2a2a2a" : "transparent"
                    border.color: "#333"
                    radius: 10
                }
                contentItem: RowLayout {
                    spacing: 10
                    Item { Layout.preferredWidth: 5 } // 左边距
                    Text { text: "+"; color: "white"; font.pixelSize: 20 }
                    Text { 
                        text: "新建对话"; color: "white"; font.pixelSize: 14; 
                        visible: sidebarExpanded 
                    }
                }
            }

            // 历史对话列表
            ListView {
                Layout.fillWidth: true
                Layout.fillHeight: true
                clip: true
                model: sidebarExpanded ? ["如何使用Dify", "关于数字花园", "检索测试", "历史记录..."] : []
                delegate: ItemDelegate {
                    width: sidebar.width - 24
                    height: 40
                    contentItem: Text {
                        text: modelData
                        color: hovered ? "white" : "#aaa"
                        font.pixelSize: 13
                        elide: Text.ElideRight
                        verticalAlignment: Text.AlignVCenter
                    }
                    background: Rectangle {
                        color: hovered ? "#252525" : "transparent"
                        radius: 8
                    }
                }
            }

            // 底部设置按钮
            Button {
                Layout.fillWidth: true
                Layout.preferredHeight: 45
                background: Rectangle {
                    color: parent.hovered ? "#2a2a2a" : "transparent"
                    radius: 10
                }
                contentItem: RowLayout {
                    spacing: 10
                    Item { Layout.preferredWidth: 5 }
                    Text { text: "⚙️"; font.pixelSize: 18 }
                    Text { 
                        text: "设置"; color: "white"; font.pixelSize: 14; 
                        visible: sidebarExpanded 
                    }
                }
            }
        }
    }

    // ------------------ 主对话区 ------------------
    Item {
        id: mainArea
        anchors.left: sidebar.right
        anchors.right: parent.right
        anchors.top: titleBar.bottom
        anchors.bottom: parent.bottom

        ListView {
            id: chatList
            anchors.fill: parent
            anchors.margins: 40
            anchors.bottomMargin: 120
            spacing: 30
            model: ListModel { id: messageModel }
            clip: true

            delegate: ColumnLayout {
                width: chatList.width - 20
                spacing: 10
                Text {
                    text: role === "user" ? "You" : "Digital Garden"
                    color: role === "user" ? "#888" : "#007AFF"
                    font.bold: true; font.pixelSize: 12
                }
                Text {
                    text: content
                    color: "#eee"
                    font.pixelSize: 15
                    width: parent.width
                    wrapMode: Text.WordWrap
                }
            }
        }

        // ------------------ 仿 Ollama 输入框 ------------------
        Rectangle {
            id: inputContainer
            width: Math.min(parent.width - 100, 800)
            height: Math.min(200, Math.max(56, inputField.implicitHeight + 24))
            anchors.bottom: parent.bottom
            anchors.horizontalCenter: parent.horizontalCenter
            anchors.bottomMargin: 40
            color: "#1e1e1e"
            radius: 28
            border.color: inputField.activeFocus ? "#444" : "#2a2a2a"
            border.width: 1

            RowLayout {
                anchors.fill: parent
                anchors.leftMargin: 20
                anchors.rightMargin: 12
                spacing: 10

                ScrollView {
                    Layout.fillWidth: true
                    Layout.fillHeight: true
                    Layout.topMargin: 8
                    Layout.bottomMargin: 8
                    ScrollBar.vertical.policy: ScrollBar.AsNeeded
                    
                    TextArea {
                        id: inputField
                        placeholderText: "向数字花园发送消息..."
                        placeholderTextColor: "#555"
                        color: "white"
                        font.pixelSize: 15
                        background: null
                        wrapMode: Text.WordWrap
                        selectByMouse: true
                        verticalAlignment: Text.AlignVCenter
                    }
                }

                // 单一发送按钮
                RoundButton {
                    id: sendButton
                    Layout.preferredWidth: 36
                    Layout.preferredHeight: 36
                    Layout.alignment: Qt.AlignBottom
                    Layout.bottomMargin: 8
                    contentItem: Text {
                        text: "↑"
                        color: inputField.text.length > 0 ? "black" : "#666"
                        font.bold: true
                        font.pixelSize: 18
                        horizontalAlignment: Text.AlignHCenter
                        verticalAlignment: Text.AlignVCenter
                    }
                    background: Rectangle {
                        radius: 18
                        color: inputField.text.length > 0 ? "white" : "#2a2a2a"
                    }
                    onClicked: {
                        if (inputField.text.trim() !== "") {
                            messageModel.append({"role": "user", "content": inputField.text})
                            chatController.send_message(inputField.text)
                            inputField.clear()
                            chatList.positionViewAtEnd()
                        }
                    }
                }
            }
        }
    }

    // 后端连接
    Connections {
        target: chatController
        function onMessageReceived(msg) {
            messageModel.append({"role": "assistant", "content": msg})
            chatList.positionViewAtEnd()
        }
    }
}
```

### 三、 关键修改点说明

1.  **无边框窗口 (`flags: Qt.FramelessWindowHint`)**:
    *   解决了 Windows 默认白边标题栏的问题。
    *   引入了 `titleBar` 矩形和 `DragHandler`，使你仍然可以拖动窗口。
2.  **侧边栏逻辑**:
    *   新增了 `sidebarExpanded` 状态切换。
    *   使用了 `Behavior on sidebarWidth` 让伸缩过程有平滑过渡效果。
    *   设置按钮和新建按钮改为 `RowLayout`，根据宽度自动隐藏文字。
3.  **输入框重构**:
    *   **删除了多余的 RowLayout**，解决了图中出现两个箭头的问题。
    *   使用了 `Math.max` 动态计算高度，使输入框能随文字增多而长高（类似现代聊天软件）。
    *   发送按钮颜色根据是否有文字自动切换（有字时为白色亮起）。

你可以将此代码上传到 Trae，它会自动识别 QML 语法的变化并应用。