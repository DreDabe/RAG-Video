
分析你提供的 `main.qml` 代码，最大化图标无法完成实时逻辑切换的原因在于：

**在 `Qt.FramelessWindowHint`（无边框窗口）模式下，`window.visibility` 属性的变化信号有时无法实时触发 QML 的属性绑定（Property Binding）刷新。**

目前的代码中，图标的 `opacity`（透明度）直接依赖于 `window.visibility === Window.Maximized`。当你点击按钮调用 `window.showMaximized()` 时，窗口虽然变大了，但 QML 引擎可能没有立即收到 `visibility` 改变的通知，导致图标状态停留在原地。直到你再次点击（触发了重绘或 MouseArea 的状态改变），它才重新计算绑定。

### 修改方案

利用你已经在代码顶部定义的 `property bool windowMaximized: false` 作为一个明确的状态开关，手动控制状态同步。

请对以下三处“最大化逻辑相关”的部分进行修改：

#### 1. 标题栏双击逻辑（同步状态）
修改 `titleBar` 下 `MouseArea` 的 `onDoubleClicked`：

```qml
onDoubleClicked: {
    if (window.visibility === Window.Maximized) {
        window.showNormal()
        window.windowMaximized = false // 手动同步
    } else {
        window.showMaximized()
        window.windowMaximized = true  // 手动同步
    }
}
```

#### 2. `WindowBtn` 组件模版的图标绑定
将 `opacity` 的判断条件由 `window.visibility === Window.Maximized` 改为使用我们定义的布尔值 `window.windowMaximized`：

```qml
component WindowBtn : Rectangle {
    // ... 其他属性不变 ...
    
    // 主图标 (最大化图标)
    Image {
        // ...
        // 修改此处判断条件
        opacity: btnRoot.altIconSource !== "" ? (window.windowMaximized ? 0.0 : (btnMa.containsMouse ? 1.0 : 0.6)) : (btnMa.containsMouse ? 1.0 : 0.6)
        Behavior on opacity { NumberAnimation { duration: 200 } }
    }
    
    // 备用图标 (小化/还原图标)
    Image {
        // ...
        // 修改此处判断条件
        opacity: btnRoot.altIconSource !== "" ? (window.windowMaximized ? 1.0 : 0.0) : 0.0
        Behavior on opacity { NumberAnimation { duration: 200 } }
    }
    // ...
}
```

#### 3. 最大化按钮的点击逻辑（切换状态）
修改最大化按钮实例的 `clickAction`：

```qml
WindowBtn {
    iconSource: "img/最大化.svg"
    altIconSource: "img/小化.svg"
    clickAction: function() { 
        if (window.windowMaximized) {
            window.showNormal()
            window.windowMaximized = false // 切换状态
        } else {
            window.showMaximized()
            window.windowMaximized = true  // 切换状态
        }
    }
}
```

### 总结
通过将逻辑判断从不稳定的系统属性 `window.visibility` 转移到自定义的 `window.windowMaximized` 变量上，并确保在点击动作发生的瞬间立即修改该变量，即可强制 QML 引擎触发图标透明度的 `Behavior` 动画，从而实现图标的即时切换。