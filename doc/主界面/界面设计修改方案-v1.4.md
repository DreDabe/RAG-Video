针对你遇到的标题栏（Title Bar）在拖动时发生位移以及右侧按钮消失的问题，这通常是由于 `DragHandler` 与无边框窗口的坐标同步问题，以及布局组件在窗口边缘的拉伸策略导致的。

以下是修复方案和优化后的代码：

### 一、 问题诊断与改进描述

1.  **位移问题 (Displacement during Drag)**：
    *   **原因**：`DragHandler` 有时会尝试移动它所在的 `Rectangle` 组件本身，而不是整个窗口，导致在拖拽过程中标题栏相对于窗口发生了偏移。
    *   **解决**：改用传统的 `MouseArea` 配合 `window.startSystemMove()`。这是处理 PySide/Qt 无边框窗口拖拽最稳定、性能最好的方式。
2.  **按钮不可见问题 (Invisible Buttons)**：
    *   **原因 1**：布局拉伸策略。如果中间的 `Item { Layout.fillWidth: true }` 抢占了过多空间，或者标题栏宽度未正确绑定，按钮会被挤出可见区域。
    *   **原因 2**：颜色与字体。如果系统未安装 `Segoe Fluent Icons` 字体，对应的 Unicode 字符可能显示为空白。
    *   **解决**：将按钮组（Row）通过 `anchors.right` 强制固定在标题栏右侧，并提供基础字符作为图标备选方案，同时调亮按钮的默认颜色。

---

### 二、 修复后的代码 (`main.qml` 中的标题栏部分)

请用以下代码替换你原有的 `titleBar` 部分：

```qml
    // ------------------ 修复版沉浸式标题栏 ------------------
    Rectangle {
        id: titleBar
        // 确保标题栏始终横跨窗口顶部
        anchors.top: parent.top
        anchors.left: parent.left
        anchors.right: parent.right
        height: 32
        color: "#0c0c0e"
        z: 1000 // 确保在最顶层

        // 【解决问题1】稳定的窗口拖动逻辑
        MouseArea {
            anchors.fill: parent
            // 只在点击时触发系统移动，不拦截子组件的点击
            onPressed: window.startSystemMove()
            // 双击切换最大化
            onDoubleClicked: {
                if (window.visibility === Window.Maximized) window.showNormal()
                else window.showMaximized()
            }
        }

        // 标题内容层
        RowLayout {
            anchors.fill: parent
            anchors.leftMargin: 12
            anchors.rightMargin: 0 // 右侧边距设为0，由按钮组自控
            spacing: 0
            
            // 左侧：Logo 和 标题
            Row {
                Layout.alignment: Qt.AlignVCenter
                spacing: 10
                Rectangle {
                    width: 12; height: 12; radius: 3
                    color: "#3b82f6"
                    anchors.verticalCenter: parent.verticalCenter
                }
                Text {
                    text: "Digital Garden Chat"
                    color: "#e4e4e7" // 调亮文字，提高对比度
                    font.pixelSize: 11
                    font.weight: Font.Medium
                }
            }

            // 中间占位弹簧
            Item { Layout.fillWidth: true }

            // 【解决问题2】强制右侧对齐的按钮组
            Row {
                id: controlButtons
                height: 32
                
                // 按钮组件模版
                component WindowBtn : Rectangle {
                    id: btnRoot
                    property string icon: ""
                    property color hoverColor: "#27272a"
                    property var clickAction: null
                    
                    width: 46; height: 32
                    color: btnMa.containsMouse ? hoverColor : "transparent"
                    
                    Text {
                        anchors.centerIn: parent
                        text: btnRoot.icon
                        color: btnMa.containsMouse ? "white" : "#a1a1aa"
                        font.pixelSize: 10
                        // 优先使用图标字体，如果失败则显示普通字符
                        font.family: "Segoe Fluent Icons, Segoe MDL2 Assets, sans-serif"
                    }
                    
                    MouseArea {
                        id: btnMa; anchors.fill: parent; hoverEnabled: true
                        onClicked: if (clickAction) clickAction()
                    }
                }

                WindowBtn {
                    icon: "—" // 最小化
                    clickAction: function() { window.showMinimized() }
                }

                WindowBtn {
                    icon: window.visibility === Window.Maximized ? "❐" : "▢" // 最大化/还原
                    clickAction: function() { 
                        if (window.visibility === Window.Maximized) window.showNormal()
                        else window.showMaximized()
                    }
                }

                WindowBtn {
                    icon: "✕" // 关闭
                    hoverColor: "#e81123"
                    clickAction: function() { window.close() }
                }
            }
        }
    }
```

### 三、 修改要点说明

1.  **Anchors 替代 Width**: 使用 `anchors.left: parent.left` 和 `anchors.right: parent.right` 代替 `width: parent.width`。这样当窗口大小改变（如最大化）时，标题栏能完美自适应，不会出现位移。
2.  **MouseArea 代理**: `DragHandler` 在 QML 引擎中对于底层窗口（Window）的控制有时存在延迟或计算错误。`window.startSystemMove()` 是 Qt 官方推荐的无边框拖拽 API，它将控制权移交给操作系统，极其流畅。
3.  **按钮显示保障**: 
    *   在 `Text` 组建中，我将 `font.family` 设置为多个备选方案。如果系统没有漂亮的 Fluent 图标字体，它会自动回退到普通的 `—` 和 `✕`。
    *   将按钮容器的 `z` 轴或父级布局设为 `z: 1000`，确保它不会被主界面的其他内容遮挡。
    *   标题文字颜色从之前的灰色 (`#71717a`) 调亮到了锌白 (`#e4e4e7`)，使其在暗色背景下更加清晰。

你可以将此代码放入 Trae，它应该能即刻解决你观察到的视觉和交互 Bug。