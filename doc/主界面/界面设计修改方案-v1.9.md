针对你描述的“最大化后拖拽还原位置偏移”问题，核心原因在于：在无边框模式下，从最大化切换回正常大小时，窗口的坐标系和尺寸会发生瞬间跳转，如果计算逻辑没有紧密跟随全局屏幕坐标（Screen Coordinates），窗口就会跳回原来的固定位置。

以下是修复后的 `titleBar` 部分的代码逻辑。

### 1. 标题栏拖拽逻辑修复方案 (Markdown 描述)

*   **逻辑原理**：
    1.  **比例锁定**：在鼠标移动的瞬间，计算当前鼠标在**全屏标题栏**上的百分比位置（例如：点击在右侧 80% 处）。
    2.  **状态捕获**：获取鼠标在屏幕上的**绝对坐标**（`screenX`）。
    3.  **瞬间还原与重置**：调用 `showNormal()` 后，立即根据之前锁定的百分比和**还原后的窗口宽度**计算新的 `x` 坐标。
    4.  **计算公式**：`window.x = 鼠标屏幕绝对X - (还原后窗口宽度 * 比例)`。
    5.  **无缝衔接**：完成位移后立即调用 `startSystemMove()`，使用户感觉窗口是“吸附”在鼠标上被拖出来的。

---

### 2. 参考修复代码

请将 `main.qml` 中 `titleBar` 内部的 `MouseArea` 替换为以下代码：

```qml
        MouseArea {
            id: titleBarMouseArea
            anchors.fill: parent
            
            // 记录按下时的状态，用于后续判断
            onPressed: {
                if (!window.windowMaximized) {
                    window.startSystemMove()
                }
            }
            
            // 核心修复：拖拽还原逻辑
            onPositionChanged: function(mouse) {
                if (pressed && window.windowMaximized) {
                    // 1. 获取当前全局屏幕坐标和比例
                    // 注意：在最大化状态下，titleBar.width 等于屏幕宽度
                    var sx = mouse.screenX
                    var sy = mouse.screenY
                    var ratio = mouse.x / titleBar.width 
                    var localY = mouse.y // 鼠标在标题栏内的相对高度

                    // 2. 切换窗口状态
                    window.showNormal()
                    window.windowMaximized = false

                    // 3. 重新计算位置：
                    // 使窗口在鼠标下方，且保持鼠标在标题栏上的横向比例
                    // window.width 此时已经是还原后的宽度（例如 1100）
                    window.x = sx - (window.width * ratio)
                    // 纵坐标：全局Y - 鼠标在标题栏内的相对高度，确保鼠标垂直居中在标题栏
                    window.y = sy - localY

                    // 4. 立即交给系统接管拖动，实现丝滑移动
                    window.startSystemMove()
                }
            }
            
            // 双击逻辑保持不变
            onDoubleClicked: {
                if (window.windowMaximized) {
                    window.showNormal()
                    window.windowMaximized = false
                } else {
                    window.showMaximized()
                    window.windowMaximized = true
                }
            }
        }
```

### 3. 代码修改说明

1.  **变量范围 (`var`)**：在 QML 的 Javascript 函数中，建议使用 `var` 确保属性访问的兼容性（尤其是在处理 `mouse` 对象的属性时）。
2.  **比例计算 (`ratio`)**：
    *   我们在 `window.showNormal()` **之前**计算 `ratio`（基于全屏宽度）。
    *   我们在 `window.showNormal()` **之后**应用这个 `ratio` 乘到 `window.width`（还原后的宽度）。这样无论你从屏幕哪个位置拉下来，窗口都会按比例对齐。
3.  **垂直定位 (`window.y`)**：
    *   使用 `sy - localY` 而不是简单的 `sy - 16` 之类的固定值。这样如果你点击在标题栏的边缘，还原后鼠标依然会在边缘，不会有“抖动”。
