
针对你提出的细节优化需求，我重新审视了界面逻辑，并参考了现代 UI 设计规范（如 Shadcn UI 和 Ollama 的极简风格）进行了调色。

以下是针对 `digital-garden-chat` 的改进方案：

### 一、 设计与配色方案描述 (Markdown)

#### 1. 现代暗黑系调色盘 (The "Zinc" Palette)
参考了主流 AI 工具的高级感配色，采用深灰色系而非纯黑，增加视觉层级：
*   **主背景 (Main BG)**: `#09090b` (极深锌色，沉浸感强)
*   **侧边栏/标题栏 (Sidebar/Titlebar)**: `#0f0f10` (略亮于背景，区分功能区)
*   **容器/输入框 (Surface)**: `#18181b` (组件背景)
*   **交互状态**:
    *   **Normal**: 文本颜色 `#a1a1aa` (中灰)
    *   **Hover**: 背景变为 `#27272a`，文本变为 `#ffffff`
    *   **Active (点击)**: 背景变为 `#3f3f46`
    *   **Accent (高亮)**: 发送按钮在有内容时使用 `#ffffff` (纯白)，无内容时为 `#27272a`

#### 2. 侧边栏伸缩逻辑改进
*   **按钮形态**: 切换按钮现在是一个横向的圆角矩形按钮，与“新建对话”对齐。
*   **平滑过渡**: 使用 `Opacity` 和 `Layout` 属性结合动画。折叠时，文字标签透明度归零并缩小占位，图标通过 `Layout.alignment: Qt.AlignHCenter` 保持在窄条的正中心。

#### 3. 自定义标题栏修复
*   **全宽覆盖**: 标题栏直接作为窗口最顶层组件，宽度设为 `parent.width`。
*   **功能补完**: 添加了“最大化/还原”按钮逻辑，并优化了三个功能按键的悬浮反馈（关闭按钮悬浮变红）。

---

### 二、 参考代码实现 (`main.qml`)

```qml
import QtQuick
import QtQuick.Controls
import QtQuick.Layouts
import QtQuick.Window

ApplicationWindow {
    id: window
    width: 1100
    height: 750
    visible: true
    title: "digital-garden-chat"
    color: "#09090b" // 主背景色
    
    flags: Qt.Window | Qt.FramelessWindowHint

    property real sidebarWidth: 260
    property bool sidebarExpanded: true

    // 动画配置
    Behavior on sidebarWidth {
        NumberAnimation { duration: 300; easing.type: Easing.InOutExpo }
    }

    // ------------------ 自定义标题栏 ------------------
    Rectangle {
        id: titleBar
        width: parent.width
        height: 32
        color: "#0f0f10"
        z: 100

        DragHandler {
            onActiveChanged: if (active) window.startSystemMove()
        }

        RowLayout {
            anchors.fill: parent
            anchors.leftMargin: 15
            anchors.rightMargin: 0
            spacing: 0
            
            Text {
                text: "Digital Garden Chat"
                color: "#71717a"
                font.pixelSize: 11
                Layout.alignment: Qt.AlignVCenter
            }

            Item { Layout.fillWidth: true } // 弹簧占位

            // 窗口控制组
            Row {
                height: 32
                Repeater {
                    model: [
                        { icon: "—", action: function() { window.showMinimized() }, hover: "#27272a" },
                        { icon: window.visibility === Window.Maximized ? "❐" : "▢", action: function() { window.visibility === Window.Maximized ? window.showNormal() : window.showMaximized() }, hover: "#27272a" },
                        { icon: "✕", action: function() { window.close() }, hover: "#e11d48" }
                    ]
                    delegate: Rectangle {
                        width: 45
                        height: 32
                        color: btnMouse.containsMouse ? modelData.hover : "transparent"
                        Text {
                            anchors.centerIn: parent
                            text: modelData.icon
                            color: btnMouse.containsMouse ? "white" : "#71717a"
                            font.pixelSize: 14
                        }
                        MouseArea {
                            id: btnMouse
                            anchors.fill: parent
                            hoverEnabled: true
                            onClicked: modelData.action()
                        }
                    }
                }
            }
        }
    }

    // ------------------ 侧边栏 ------------------
    Rectangle {
        id: sidebar
        width: sidebarWidth
        anchors.left: parent.left
        anchors.top: titleBar.bottom
        anchors.bottom: parent.bottom
        color: "#0f0f10"
        
        // 右侧细边框
        Rectangle {
            anchors.right: parent.right
            width: 1
            height: parent.height
            color: "#18181b"
        }

        ColumnLayout {
            anchors.fill: parent
            anchors.margins: 12
            spacing: 8

            // 伸缩切换按钮 (横向样式)
            Button {
                id: toggleBtn
                Layout.fillWidth: true
                Layout.preferredHeight: 40
                onClicked: {
                    sidebarExpanded = !sidebarExpanded
                    sidebarWidth = sidebarExpanded ? 260 : 64
                }
                background: Rectangle {
                    color: toggleBtn.hovered ? "#18181b" : "transparent"
                    radius: 6
                }
                contentItem: RowLayout {
                    spacing: 12
                    Item { Layout.preferredWidth: (sidebarWidth - 24 - 20) / 2; visible: !sidebarExpanded } // 居中修正
                    Text { 
                        text: "☰"; color: toggleBtn.hovered ? "white" : "#a1a1aa"
                        font.pixelSize: 16; Layout.alignment: Qt.AlignVCenter 
                    }
                    Text { 
                        text: "收起侧栏"; color: "white"; font.pixelSize: 13
                        visible: sidebarExpanded; opacity: sidebarExpanded ? 1 : 0
                        Behavior on opacity { NumberAnimation { duration: 200 } }
                    }
                }
            }

            // 新建对话
            Button {
                id: newChatBtn
                Layout.fillWidth: true
                Layout.preferredHeight: 40
                background: Rectangle {
                    color: newChatBtn.hovered ? "#18181b" : "transparent"
                    border.color: "#27272a"
                    radius: 6
                }
                contentItem: RowLayout {
                    spacing: 12
                    Item { Layout.preferredWidth: (sidebarWidth - 24 - 20) / 2; visible: !sidebarExpanded }
                    Text { text: "+"; color: "white"; font.pixelSize: 18 }
                    Text { 
                        text: "新建对话"; color: "white"; font.pixelSize: 13
                        visible: sidebarExpanded; opacity: sidebarExpanded ? 1 : 0
                    }
                }
            }

            // 历史列表
            ListView {
                Layout.fillWidth: true
                Layout.fillHeight: true
                Layout.topMargin: 10
                clip: true
                model: ["如何使用Dify", "数字花园简介", "检索功能测试"]
                delegate: ItemDelegate {
                    id: listDel
                    width: sidebar.width - 24
                    height: 36
                    contentItem: RowLayout {
                        spacing: 12
                        Text { 
                            text: "•"; color: listDel.hovered ? "white" : "#3f3f46"
                            font.pixelSize: 18; visible: !sidebarExpanded
                            Layout.alignment: Qt.AlignHCenter
                        }
                        Text {
                            text: modelData; color: listDel.hovered ? "white" : "#a1a1aa"
                            font.pixelSize: 13; elide: Text.ElideRight
                            visible: sidebarExpanded
                        }
                    }
                    background: Rectangle {
                        color: listDel.hovered ? "#18181b" : "transparent"
                        radius: 6
                    }
                }
            }

            // 设置
            Button {
                id: setBtn
                Layout.fillWidth: true
                Layout.preferredHeight: 40
                background: Rectangle {
                    color: setBtn.hovered ? "#18181b" : "transparent"
                    radius: 6
                }
                contentItem: RowLayout {
                    spacing: 12
                    Item { Layout.preferredWidth: (sidebarWidth - 24 - 20) / 2; visible: !sidebarExpanded }
                    Text { text: "⚙️"; font.pixelSize: 16 }
                    Text { text: "设置"; color: "#a1a1aa"; font.pixelSize: 13; visible: sidebarExpanded }
                }
            }
        }
    }

    // ------------------ 主对话区 ------------------
    Item {
        id: mainArea
        anchors.left: sidebar.right
        anchors.right: parent.right
        anchors.top: titleBar.bottom
        anchors.bottom: parent.bottom

        ListView {
            id: chatList
            anchors.fill: parent
            anchors.margins: 50
            anchors.bottomMargin: 140
            spacing: 32
            model: ListModel { id: messageModel }
            clip: true

            delegate: ColumnLayout {
                width: chatList.width
                spacing: 12
                Text {
                    text: role === "user" ? "You" : "Digital Garden"
                    color: role === "user" ? "#71717a" : "#3b82f6"
                    font.bold: true; font.pixelSize: 12
                }
                Text {
                    text: content; color: "#e4e4e7"
                    font.pixelSize: 15; width: parent.width; wrapMode: Text.WordWrap
                    lineHeight: 1.4
                }
            }
        }

        // ------------------ 仿 Ollama 输入框 ------------------
        Rectangle {
            id: inputContainer
            width: Math.min(parent.width - 120, 800)
            height: Math.min(200, Math.max(56, inputField.implicitHeight + 24))
            anchors.bottom: parent.bottom
            anchors.horizontalCenter: parent.horizontalCenter
            anchors.bottomMargin: 40
            color: "#18181b"
            radius: 24
            border.color: inputField.activeFocus ? "#3f3f46" : "#27272a"

            RowLayout {
                anchors.fill: parent
                anchors.leftMargin: 20
                anchors.rightMargin: 12
                spacing: 10

                ScrollView {
                    Layout.fillWidth: true
                    Layout.fillHeight: true
                    Layout.topMargin: 8; Layout.bottomMargin: 8
                    TextArea {
                        id: inputField
                        placeholderText: "向数字花园发送消息..."
                        placeholderTextColor: "#52525b"
                        color: "white"
                        font.pixelSize: 15
                        background: null
                        wrapMode: Text.WordWrap
                        verticalAlignment: Text.AlignVCenter
                    }
                }

                RoundButton {
                    Layout.preferredWidth: 32; Layout.preferredHeight: 32
                    Layout.alignment: Qt.AlignBottom; Layout.bottomMargin: 10
                    contentItem: Text {
                        text: "↑"; color: inputField.text.length > 0 ? "black" : "#71717a"
                        font.bold: true; font.pixelSize: 16; horizontalAlignment: Text.AlignHCenter
                    }
                    background: Rectangle {
                        radius: 16
                        color: inputField.text.length > 0 ? "white" : "#27272a"
                    }
                    onClicked: {
                        if (inputField.text.trim() !== "") {
                            messageModel.append({"role": "user", "content": inputField.text})
                            chatController.send_message(inputField.text)
                            inputField.clear()
                            chatList.positionViewAtEnd()
                        }
                    }
                }
            }
        }
    }
}
```

### 三、 主要修复点详解

1.  **伸缩按钮动画逻辑**:
    *   使用了空项目 `Item` 作为“弹簧”，在折叠状态下通过计算宽度自动将图标推向中心位置。
    *   文字使用了 `opacity` 的变化配合 `visible`，防止在动画过程中文字突然消失造成的闪烁感。
2.  **标题栏全屏适配**:
    *   `titleBar` 位于整个界面的最上方，且 `z: 100` 确保它不会被侧边栏遮挡。
    *   增加了标准的三大按键（最小化、最大化、关闭），其中关闭按钮在悬浮时会变成标志性的红色。
3.  **配色一致性**:
    *   放弃了 `#0f0f0f` 这种绝对黑，改用 `#09090b` (Zinc 950)。这种颜色在显示器上看起来更有深度，能更好地衬托出 `#ffffff` 的文字和白色发送按钮。
    *   组件间的边框线使用 `#27272a`，非常克制，只在必要时起到分割作用。
4.  **交互反馈**:
    *   所有按钮（侧边栏条目、标题栏按键、输入框按钮）都添加了清晰的 `hover` 状态色。